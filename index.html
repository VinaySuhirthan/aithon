<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TouristSpot Finder</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --primary: #1a73e8;
            --primary-light: #e8f0fe;
            --primary-hover: #1557b0;
            --accent: #1e8e3e;
            --bg: #ffffff;
            --surface: #ffffff;
            --surface-2: #f8f9fb;
            --text-primary: #0d0f1a;
            --text-secondary: #4a5568;
            --text-tertiary: #9aa3b2;
            --border: #e8edf5;
            --border-light: #f2f4f8;
            --shadow-xs: 0 1px 3px rgba(0,0,0,0.04), 0 1px 2px rgba(0,0,0,0.03);
            --shadow-sm: 0 4px 12px rgba(0,0,0,0.05), 0 1px 3px rgba(0,0,0,0.04);
            --shadow-md: 0 8px 24px rgba(0,0,0,0.07), 0 2px 8px rgba(0,0,0,0.04);
            --shadow-focus: 0 0 0 3px rgba(26,115,232,0.12);
            --shadow-btn: 0 2px 8px rgba(26,115,232,0.22), 0 1px 3px rgba(26,115,232,0.12);
            --radius-xl: 20px;
            --radius-lg: 16px;
            --radius-md: 12px;
            --radius-sm: 10px;
            --transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-fast: 0.15s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            height: 100%;
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg);
            color: var(--text-primary);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            min-height: 100%;
        }

        #app {
            max-width: 430px;
            margin: 0 auto;
            padding: 0 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* â”€â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        header {
            text-align: center;
            padding: 56px 0 28px;
        }

        .logo-mark {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 52px;
            height: 52px;
            background: linear-gradient(135deg, #1a73e8 0%, #4285f4 100%);
            border-radius: 14px;
            margin-bottom: 20px;
            box-shadow: 0 4px 14px rgba(26,115,232,0.3);
        }

        .logo-mark svg {
            width: 26px;
            height: 26px;
            fill: white;
        }

        header h1 {
            font-size: 2rem;
            font-weight: 800;
            color: var(--text-primary);
            letter-spacing: -0.04em;
            line-height: 1.15;
            margin-bottom: 10px;
        }

        header h1 .brand {
            background: linear-gradient(135deg, #1a73e8 0%, #4285f4 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        header p {
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 450;
            letter-spacing: -0.01em;
            line-height: 1.5;
        }

        /* â”€â”€â”€ SEARCH CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .search-container {
            background: var(--surface);
            padding: 24px 20px;
            border-radius: var(--radius-xl);
            border: 1px solid var(--border);
            margin: 8px 0 28px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            box-shadow: var(--shadow-sm);
            transition: box-shadow var(--transition), border-color var(--transition);
        }

        .search-container:focus-within {
            box-shadow: var(--shadow-md);
            border-color: rgba(26,115,232,0.2);
        }

        .input-group {
            position: relative;
            display: flex;
            flex-direction: column;
            gap: 7px;
        }

        .input-group label {
            font-size: 0.68rem;
            font-weight: 700;
            color: var(--text-tertiary);
            letter-spacing: 0.07em;
            text-transform: uppercase;
            padding-left: 2px;
        }

        .input-wrapper {
            position: relative;
        }

        .input-icon {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            width: 16px;
            height: 16px;
            pointer-events: none;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .input-icon svg {
            width: 16px;
            height: 16px;
            stroke: var(--text-tertiary);
            stroke-width: 2;
            fill: none;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .input-group input {
            width: 100%;
            padding: 13px 16px 13px 40px;
            border: 1.5px solid var(--border);
            border-radius: var(--radius-md);
            font-size: 0.95rem;
            font-family: inherit;
            font-weight: 500;
            color: var(--text-primary);
            background: var(--surface-2);
            transition: border-color var(--transition-fast), box-shadow var(--transition-fast), background var(--transition-fast);
            outline: none;
            -webkit-appearance: none;
        }

        .input-group input::placeholder {
            color: var(--text-tertiary);
            font-weight: 400;
            font-size: 0.9rem;
        }

        .input-group input:focus {
            border-color: var(--primary);
            box-shadow: var(--shadow-focus);
            background: var(--surface);
        }

        /* divider between inputs */
        .input-divider {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 0 2px;
        }

        .input-divider-line {
            flex: 1;
            height: 1px;
            background: var(--border-light);
        }

        .swap-icon {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 1.5px solid var(--border);
            background: var(--surface);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-tertiary);
            font-size: 0.75rem;
            flex-shrink: 0;
        }

        /* â”€â”€â”€ BUTTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .button-group {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 10px;
            margin-top: 4px;
        }

        .btn {
            min-height: 48px;
            padding: 13px 18px;
            border-radius: var(--radius-md);
            font-size: 0.9rem;
            font-weight: 650;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 7px;
            border: none;
            font-family: inherit;
            letter-spacing: -0.01em;
            position: relative;
            overflow: hidden;
            touch-action: manipulation;
            white-space: nowrap;
        }

        .btn:active {
            transform: scale(0.97);
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            box-shadow: var(--shadow-btn);
            font-size: 0.95rem;
            font-weight: 700;
        }

        .btn-primary:active {
            background: var(--primary-hover);
            box-shadow: 0 4px 16px rgba(26,115,232,0.28);
        }

        .btn-secondary {
            background: var(--surface-2);
            color: var(--text-secondary);
            border: 1.5px solid var(--border);
            font-size: 0.85rem;
        }

        .btn-secondary:active {
            background: var(--primary-light);
            border-color: var(--primary);
            color: var(--primary);
        }

        .btn-icon {
            font-size: 1rem;
            line-height: 1;
        }

        /* â”€â”€â”€ AUTOCOMPLETE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .suggestions-container {
            position: absolute;
            top: calc(100% + 4px);
            left: 0;
            right: 0;
            background: var(--surface);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-md);
            z-index: 1001;
            max-height: 260px;
            overflow-y: auto;
            border: 1px solid var(--border);
        }

        .suggestion-item {
            padding: 13px 16px;
            cursor: pointer;
            transition: background var(--transition-fast);
            font-size: 0.875rem;
            color: var(--text-primary);
            border-bottom: 1px solid var(--border-light);
            font-weight: 450;
            display: flex;
            align-items: center;
            gap: 10px;
            touch-action: manipulation;
        }

        .suggestion-item::before {
            content: '';
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--border);
            flex-shrink: 0;
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-item:active {
            background: var(--primary-light);
            color: var(--primary);
        }

        /* â”€â”€â”€ LOADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .loader-container {
            text-align: center;
            padding: 80px 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0;
        }

        .loader {
            width: 40px;
            height: 40px;
            border: 2.5px solid var(--border-light);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.75s linear infinite;
            margin-bottom: 16px;
        }

        .loader-container p {
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
            letter-spacing: -0.01em;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* â”€â”€â”€ SPOTS GRID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .spots-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 14px;
        }

        .spot-card {
            background: var(--surface);
            border-radius: var(--radius-xl);
            padding: 20px;
            border: 1px solid var(--border);
            transition: box-shadow var(--transition), transform var(--transition), border-color var(--transition);
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .spot-card:active {
            box-shadow: var(--shadow-md);
            transform: scale(0.99);
            border-color: rgba(26,115,232,0.2);
        }

        .crowd-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 100px;
            font-size: 0.78rem;
            font-weight: 700;
            width: fit-content;
            letter-spacing: -0.01em;
        }

        .crowd-bar-container {
            width: 100%;
            height: 5px;
            background: var(--border-light);
            border-radius: 20px;
            overflow: hidden;
            margin-top: 6px;
        }

        .crowd-bar-fill {
            height: 100%;
            border-radius: 20px;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            width: 0%;
        }

        .crowd-low  { background: #ecfdf5; color: #059669; }
        .crowd-mod  { background: #fffbeb; color: #d97706; }
        .crowd-high { background: #fef2f2; color: #dc2626; }
        .crowd-unknown { background: var(--border-light); color: var(--text-tertiary); }

        .spot-card h3 {
            font-size: 1.05rem;
            font-weight: 750;
            color: var(--text-primary);
            letter-spacing: -0.025em;
            line-height: 1.3;
        }

        .spot-card .address {
            font-size: 0.82rem;
            color: var(--text-secondary);
            height: 2.6em;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .spot-meta {
            display: flex;
            justify-content: space-between;
            padding-top: 12px;
            border-top: 1px solid var(--border-light);
            gap: 10px;
        }

        .meta-item {
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        .meta-label {
            font-size: 0.65rem;
            text-transform: uppercase;
            color: var(--text-tertiary);
            font-weight: 700;
            letter-spacing: 0.06em;
            margin-bottom: 3px;
        }

        .meta-value {
            font-size: 0.95rem;
            font-weight: 750;
            color: var(--primary);
            letter-spacing: -0.02em;
        }

        /* â”€â”€â”€ UTILITY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .hidden { display: none !important; }

        /* â”€â”€â”€ FOOTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        footer {
            text-align: center;
            margin-top: auto;
            padding: 36px 0 24px;
            color: var(--text-tertiary);
            font-size: 0.75rem;
            font-weight: 500;
            letter-spacing: -0.01em;
        }

        footer strong {
            color: var(--text-secondary);
            font-weight: 700;
        }

        footer .divider {
            display: inline-block;
            margin: 0 6px;
            opacity: 0.4;
        }

        /* â”€â”€â”€ MEDIA QUERIES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        @media (min-width: 480px) {
            #app {
                max-width: 460px;
                padding: 0 24px;
            }
            header { padding-top: 72px; }
            header h1 { font-size: 2.2rem; }
        }
    </style>
</head>

<body>
    <div id="app">
        <header>
            <div class="logo-mark">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                </svg>
            </div>
            <h1><span class="brand">TouristSpot</span> Finder</h1>
            <p>Discover the top 5 best tourist spots near you</p>
        </header>

        <main>
            <div class="search-container">
                <div class="input-group">
                    <label for="from-input">Starting from</label>
                    <div class="input-wrapper">
                        <span class="input-icon">
                            <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M12 2v3M12 19v3M2 12h3M19 12h3"/></svg>
                        </span>
                        <input type="text" id="from-input" placeholder="Current location or city..."
                            aria-label="Starting location" autocomplete="off">
                        <div id="from-suggestions" class="suggestions-container hidden"></div>
                    </div>
                </div>

                <div class="input-divider">
                    <div class="input-divider-line"></div>
                    <div class="swap-icon">â†“</div>
                    <div class="input-divider-line"></div>
                </div>

                <div class="input-group">
                    <label for="to-input">Going to</label>
                    <div class="input-wrapper">
                        <span class="input-icon">
                            <svg viewBox="0 0 24 24"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/><circle cx="12" cy="10" r="3"/></svg>
                        </span>
                        <input type="text" id="to-input" placeholder="Where do you want to explore?"
                            aria-label="Destination location" autocomplete="off">
                        <div id="to-suggestions" class="suggestions-container hidden"></div>
                    </div>
                </div>

                <div class="button-group">
                    <button id="location-btn" class="btn btn-secondary" title="Use current location for Start">
                        <span class="btn-icon">ğŸ“</span> My Location
                    </button>
                    <button id="search-btn" class="btn btn-primary">
                        Find Spots
                    </button>
                </div>
            </div>

            <div id="loader" class="loader-container hidden">
                <div class="loader"></div>
                <p>Preparing your trip results...</p>
            </div>
        </main>

        <footer>
            <p><strong>Team HacksON</strong><span class="divider">â€”</span>IMPACT AI-THON</p>
        </footer>
    </div>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = "https://patojfbjsgajzalscyuo.supabase.co";
        const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBhdG9qZmJqc2dhanphbHNjeXVvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4MjEyODIsImV4cCI6MjA4NzM5NzI4Mn0.JkOcWVhFtNOMT5jEpuyxHt2cm2qU333T7OnEuHM6D1M";
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        document.addEventListener('DOMContentLoaded', () => {
            const searchBtn = document.getElementById('search-btn');
            const fromInput = document.getElementById('from-input');
            const toInput = document.getElementById('to-input');

            searchBtn.addEventListener('click', performManualSearch);

            [fromInput, toInput].forEach(inp => {
                inp.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') performManualSearch();
                });
            });

            // Autocomplete Logic for From
            let fromTimer;
            fromInput.addEventListener('input', () => {
                clearTimeout(fromTimer);
                const input = fromInput.value.trim();
                if (input.length < 2) {
                    hideSuggestions('from-suggestions');
                    return;
                }
                fromTimer = setTimeout(() => fetchSuggestions(input, 'from-suggestions', fromInput), 300);
            });

            // Autocomplete Logic for To
            let toTimer;
            toInput.addEventListener('input', () => {
                clearTimeout(toTimer);
                const input = toInput.value.trim();
                if (input.length < 2) {
                    hideSuggestions('to-suggestions');
                    return;
                }
                toTimer = setTimeout(() => fetchSuggestions(input, 'to-suggestions', toInput), 300);
            });

            // Hide suggestions when clicking outside
            document.addEventListener('click', (e) => {
                const isInputWrapper = e.target.closest('.input-wrapper');
                if (!isInputWrapper) {
                    hideSuggestions('from-suggestions');
                    hideSuggestions('to-suggestions');
                }
            });

            const locationBtn = document.getElementById('location-btn');
            locationBtn.addEventListener('click', performLiveLocationAutoFill);
        });

        async function performManualSearch() {
            const fromVal = document.getElementById('from-input').value.trim();
            const toVal = document.getElementById('to-input').value.trim();

            if (!fromVal || !toVal) {
                alert("Please enter both starting and destination locations.");
                return;
            }

            hideSuggestions('from-suggestions');
            hideSuggestions('to-suggestions');

            try {
                showLoader("Calculating route coordinates...");
                const fromCoords = await getCoordinates(fromVal);
                const toCoords = await getCoordinates(toVal);

                // Redirect to list page with parameters
                const params = new URLSearchParams({
                    fLat: fromCoords.lat,
                    fLng: fromCoords.lng,
                    tLat: toCoords.lat,
                    tLng: toCoords.lng,
                    fName: fromVal,
                    tName: toVal
                });
                // Use /list on Render (Flask route), list.html on Live Server (localhost:5500)
                const isLiveServer = location.port === '5500';
                const listPath = isLiveServer ? 'list.html' : '/list';
                console.log("Redirecting to:", listPath);
                window.location.href = `${listPath}?${params.toString()}`;
            } catch (error) {
                console.error('Search error:', error);
                alert(`Error: ${error.message || error}`);
                hideLoader();
            }
        }

        async function performLiveLocationAutoFill() {
            if (!navigator.geolocation) {
                alert("Geolocation is not supported by your browser.");
                return;
            }

            hideSuggestions('from-suggestions');
            showLoader("Detecting your location address...");

            navigator.geolocation.getCurrentPosition(async (position) => {
                const lat = position.coords.latitude;
                const lng = position.coords.longitude;
                const coordFallback = `${lat.toFixed(6)}, ${lng.toFixed(6)}`;

                try {
                    const address = await reverseGeocode(lat, lng);
                    document.getElementById('from-input').value = address;
                } catch (error) {
                    console.warn('Reverse geocode failed, using raw coordinates:', error.message);
                    document.getElementById('from-input').value = coordFallback;
                } finally {
                    hideLoader();
                }
            }, (error) => {
                console.error('Geolocation error:', error);
                let msg = "Unable to retrieve your location.";
                if (error.code === error.TIMEOUT) msg = "Location detection timed out. Please try again or type manually.";
                if (error.code === error.PERMISSION_DENIED) msg = "Please enable location permissions in your browser.";
                alert(msg);
                hideLoader();
            }, {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 0
            });
        }

        async function enrichWithCrowdData(spots) {
            // Logic moved to list.html
        }

        function showLoader(text) {
            const loader = document.getElementById('loader');
            const loaderText = loader.querySelector('p');
            loaderText.textContent = text;
            loader.classList.remove('hidden');
        }

        function hideLoader() {
            document.getElementById('loader').classList.add('hidden');
        }

        async function fetchSuggestions(input, targetId, inputEl) {
            try {
                const url = `https://photon.komoot.io/api/?q=${encodeURIComponent(input)}&limit=6`;
                const response = await fetch(url);
                if (!response.ok) throw new Error(`Photon error: ${response.status}`);

                const data = await response.json();
                const suggestions = (data.features || []).map(f => {
                    const p = f.properties;
                    const parts = [
                        p.name,
                        p.city || p.town || p.village || p.county,
                        p.state,
                        p.country
                    ].filter(Boolean);
                    return {
                        description: parts.join(', '),
                        lat: f.geometry.coordinates[1],
                        lon: f.geometry.coordinates[0]
                    };
                }).filter(s => s.description);

                renderSuggestions(suggestions, targetId, inputEl);
            } catch (error) {
                console.error('Autocomplete error:', error);
            }
        }

        function renderSuggestions(suggestions, targetId, inputEl) {
            const container = document.getElementById(targetId);
            container.innerHTML = '';

            if (suggestions.length === 0) {
                container.classList.add('hidden');
                return;
            }

            suggestions.forEach(item => {
                const div = document.createElement('div');
                div.className = 'suggestion-item';
                div.textContent = item.description;
                div.onclick = () => {
                    inputEl.value = item.description;
                    hideSuggestions(targetId);
                };
                container.appendChild(div);
            });

            container.classList.remove('hidden');
        }

        function hideSuggestions(targetId) {
            const suggestions = document.getElementById(targetId);
            if (suggestions) suggestions.classList.add('hidden');
        }

        async function getCoordinates(address) {
            const url = `https://photon.komoot.io/api/?q=${encodeURIComponent(address)}&limit=1`;
            const response = await fetch(url);
            if (!response.ok) throw new Error(`Geocoding error: ${response.status}`);

            const data = await response.json();
            if (data.features && data.features.length > 0) {
                const [lng, lat] = data.features[0].geometry.coordinates;
                return { lat, lng };
            }
            throw new Error('Location not found. Try typing a more specific place name.');
        }

        async function reverseGeocode(lat, lng) {
            try {
                const res = await fetch(`https://photon.komoot.io/reverse?lon=${lng}&lat=${lat}&limit=1`);
                if (res.ok) {
                    const d = await res.json();
                    if (d.features && d.features.length > 0) {
                        const p = d.features[0].properties;
                        const name = p.name;
                        const city = p.city || p.town || p.village;
                        const area = p.district || p.suburb || p.county;
                        const state = p.state;
                        if (name) return [name, city || area, state].filter(Boolean).join(', ');
                        return [p.street, area, city, state].filter(Boolean).join(', ');
                    }
                }
            } catch (e) { console.warn('Photon failed:', e.message); }

            try {
                const res = await fetch(
                    `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&zoom=18&addressdetails=1`,
                    { headers: { 'User-Agent': 'TouristSpotFinder/1.0' } }
                );
                if (res.ok) {
                    const d = await res.json();
                    if (!d.error && d.address) {
                        const a = d.address;
                        const place = a.amenity || a.building || a.tourism || a.office || a.shop || a.leisure;
                        const road = a.road || a.pedestrian;
                        const area = a.suburb || a.neighbourhood || a.city_district || a.village || a.town || a.city;
                        if (place) return [place, road, area, a.state].filter(Boolean).join(', ');
                        return [road, area, a.city || a.town, a.state].filter(Boolean).join(', ');
                    }
                }
            } catch (e) { console.warn('Nominatim failed (expected on localhost):', e.message); }

            try {
                const res = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lng}&localityLanguage=en`);
                if (res.ok) {
                    const d = await res.json();
                    const parts = [d.city || d.locality, d.principalSubdivision, d.countryName].filter(Boolean);
                    if (parts.length) return parts.join(', ');
                }
            } catch (e) { console.warn('BigDataCloud failed:', e.message); }

            throw new Error('Could not detect your location name.');
        }
    </script>
</body>

</html>